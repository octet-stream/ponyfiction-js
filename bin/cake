#!/usr/bin/env node

const join = require("path").join

const {ROOT, tryDeps} = require("./helper")

tryDeps() // Check deps before including external packages

const build = require(join(ROOT, "build"))

const name = process.env.NODE_ENV
const dev = name !== "production"
const test = name === "test"
const debug = name === "debug"

function onFulfilled() {
  process.exit(0)
}

function onRejected(err) {
  console.log(err)
  process.exit(1)
}

build({
  src: join(ROOT, "src"),
  dest: ROOT,
  root: ROOT,
  env: {
    name, dev, test, debug
  }
}).then(onFulfilled, onRejected)
